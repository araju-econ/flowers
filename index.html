<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>âœ¿ FLOWER GARDEN âœ¿</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸŒ¸</text></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      width: 100vw; height: 100vh;
      overflow: hidden;
      background: #0a0014;
      font-family: 'Press Start 2P', monospace;
      cursor: default;
    }

    #bg {
      position: fixed; inset: 0;
      background-image:
        linear-gradient(rgba(160,0,255,0.06) 1px, transparent 1px),
        linear-gradient(90deg, rgba(160,0,255,0.06) 1px, transparent 1px);
      background-size: 16px 16px;
      z-index: 0;
    }
    #scanlines {
      position: fixed; inset: 0; z-index: 900; pointer-events: none;
      background: repeating-linear-gradient(0deg, transparent, transparent 3px,
        rgba(0,0,0,0.06) 3px, rgba(0,0,0,0.06) 4px);
    }
    #vignette {
      position: fixed; inset: 0; z-index: 901; pointer-events: none;
      background: radial-gradient(ellipse at center, transparent 55%, rgba(0,0,0,0.75) 100%);
    }
    #garden { position: fixed; inset: 0; z-index: 1; overflow: hidden; }

    /* â”€â”€ Flower â”€â”€ */
    .flower {
      position: absolute; top: 0; left: 0;
      cursor: pointer; will-change: transform;
      transition: filter 0.1s;
      image-rendering: pixelated;
    }
    .flower svg { display: block; image-rendering: pixelated; image-rendering: crisp-edges; }
    .flower:hover { filter: brightness(1.6) drop-shadow(0 0 10px rgba(255,180,255,0.9)); }

    /* Pop-and-disappear on click */
    .flower.popping {
      pointer-events: none;
      animation: flowerPop 0.5s steps(6) forwards;
    }
    @keyframes flowerPop {
      0%   { transform: translate(var(--px), var(--py)) rotate(var(--pr)) scale(1);   opacity: 1; }
      30%  { transform: translate(var(--px), var(--py)) rotate(var(--pr)) scale(2.0); opacity: 1; }
      60%  { transform: translate(var(--px), var(--py)) rotate(var(--pr)) scale(1.4); opacity: 0.6; }
      100% { transform: translate(var(--px), var(--py)) rotate(var(--pr)) scale(0);   opacity: 0; }
    }

    /* â”€â”€ Title â”€â”€ */
    #title {
      position: fixed; top: 0; left: 0; right: 0;
      z-index: 50; padding: 1.1rem 1rem 0.8rem; text-align: center;
      pointer-events: none;
      background: linear-gradient(rgba(10,0,20,0.9) 70%, transparent);
    }
    #title h1 {
      font-size: clamp(0.55rem, 2.2vw, 0.9rem);
      color: #ff2d9e; letter-spacing: 0.18em;
      text-shadow: 0 0 8px #ff2d9e, 0 0 24px rgba(255,45,158,0.6), 2px 2px 0 #6600aa;
      animation: titlePulse 2s steps(2) infinite;
    }
    @keyframes titlePulse { 0%,100%{opacity:1} 50%{opacity:0.85} }

    /* â”€â”€ HUD â”€â”€ */
    #hud {
      position: fixed; bottom: 1rem; right: 1rem; z-index: 50;
      padding: 0.6rem 0.9rem 0.5rem;
      background: rgba(0,0,0,0.82);
      border: 2px solid #00ffef;
      box-shadow: 0 0 0 2px #0a0014, 0 0 0 4px #00ffef,
        0 0 16px rgba(0,255,239,0.35), inset 0 0 10px rgba(0,255,239,0.07);
      font-size: 0.5rem; color: #00ffef;
      text-shadow: 0 0 8px #00ffef; line-height: 1.9;
    }
    #hud .label { color: #006655; }
    #score     { color: #ffdd00; text-shadow: 0 0 8px #ffdd00; }
    #remaining { color: #ff2d9e; text-shadow: 0 0 8px #ff2d9e; }

    /* â”€â”€ Compliment popup â”€â”€ */
    .compliment-popup {
      position: fixed; z-index: 500; pointer-events: none;
      min-width: 210px; max-width: 300px;
      background: #0f0020;
      border: 3px solid #ff2d9e;
      box-shadow: 0 0 0 3px #0f0020, 0 0 0 6px #ff2d9e,
        0 0 30px rgba(255,45,158,0.45), inset 0 0 20px rgba(255,45,158,0.07);
      animation: popupIn 0.15s steps(3) forwards;
    }
    @keyframes popupIn  { from{transform:scale(0);opacity:0} to{transform:scale(1);opacity:1} }
    .compliment-popup.fading { animation: popupOut 0.25s steps(3) forwards; }
    @keyframes popupOut { from{transform:scale(1);opacity:1} to{transform:scale(0.7);opacity:0} }
    .popup-header {
      background: #ff2d9e; padding: 0.45rem 0.8rem;
      font-size: 0.45rem; color: #fff;
      letter-spacing: 0.12em; text-align: center; text-shadow: 1px 1px 0 #880044;
    }
    .popup-heart { display: inline-block; animation: heartBeat 0.5s steps(2) infinite; }
    @keyframes heartBeat { 0%{transform:scale(1)} 50%{transform:scale(1.35)} 100%{transform:scale(1)} }
    .popup-body {
      padding: 0.85rem 0.9rem 1rem; font-size: 0.42rem;
      color: #ffcced; line-height: 2; text-align: center;
    }

    /* â”€â”€ Pixel burst particles â”€â”€ */
    .px-particle {
      position: fixed; width: 6px; height: 6px; z-index: 600;
      pointer-events: none; animation: pxFly 0.65s steps(8) forwards;
    }
    @keyframes pxFly {
      0%   { opacity:1; transform:translate(0,0) scale(1.5); }
      100% { opacity:0; transform:translate(var(--tx),var(--ty)) scale(0.4); }
    }

    /* â”€â”€ Win screen â”€â”€ */
    #win-screen {
      position: fixed; inset: 0; z-index: 800;
      background: rgba(10,0,20,0.97);
      display: none; flex-direction: column; align-items: center;
      justify-content: center; text-align: center; gap: 1.5rem;
    }
    #win-screen.show { display: flex; }
    #win-screen h2 {
      font-size: clamp(1rem,4vw,2rem); color: #ffdd00;
      animation: rainbowText 0.5s steps(6) infinite;
    }
    @keyframes rainbowText {
      0%  {color:#ff2d9e;text-shadow:0 0 20px #ff2d9e,3px 3px 0 #880044}
      17% {color:#ff6600;text-shadow:0 0 20px #ff6600,3px 3px 0 #883300}
      34% {color:#ffdd00;text-shadow:0 0 20px #ffdd00,3px 3px 0 #886600}
      51% {color:#39ff14;text-shadow:0 0 20px #39ff14,3px 3px 0 #1a7700}
      68% {color:#00ffef;text-shadow:0 0 20px #00ffef,3px 3px 0 #006655}
      85% {color:#bf00ff;text-shadow:0 0 20px #bf00ff,3px 3px 0 #550077}
    }
    #win-screen p {
      font-size: clamp(0.45rem,1.5vw,0.65rem); color: #ffcced;
      line-height: 2.2; max-width: 500px; padding: 0 1rem;
    }
    #win-screen button {
      margin-top:1rem; padding:0.8rem 1.4rem;
      background:#ff2d9e; border:3px solid #fff;
      box-shadow:0 0 0 3px #ff2d9e,0 0 20px rgba(255,45,158,0.5);
      color:#fff; font-family:'Press Start 2P',monospace;
      font-size:0.55rem; cursor:pointer; letter-spacing:0.1em;
    }
    #win-screen button:hover { filter:brightness(1.3); }
  </style>
</head>
<body>

<div id="bg"></div>
<div id="scanlines"></div>
<div id="vignette"></div>
<div id="garden"></div>

<div id="title"><h1>âœ¿ CLICK EVERY FLOWER âœ¿</h1></div>

<div id="hud">
  <span class="label">CLICKED&nbsp;&nbsp;</span><span id="score">00</span><br>
  <span class="label">REMAINING </span><span id="remaining">100</span>
</div>

<div id="win-screen">
  <h2>âœ¿ YOU DID IT! âœ¿</h2>
  <p>
    You found every single flower.<br>
    Just like I found you.<br>
    I love you, Veerangna. â™¥
  </p>
  <button onclick="resetGame()">PLAY AGAIN</button>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PIXEL ART FLOWER DEFINITIONS  (16 cols Ã— 16 rows, PX=4)
   '.' = transparent
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PX = 4;

const FLOWER_DEFS = [
  { // â”€â”€ Pink 4-petal cross
    map: [
      '......pppp......',
      '.....pppppp.....',
      '.....pp..pp.....',
      '.pp..........pp.',
      '.pp...cccc...pp.',
      '.pp...cccc...pp.',
      '.pp..........pp.',
      '.....pp..pp.....',
      '.....pppppp.....',
      '......pppp......',
      '.......gg.......',
      '.......gg.......',
      '.....ll.gg......',
      '.....ll.gg......',
      '.......gg.ll....',
      '.......gg.ll....',
    ],
    colors: { p:'#f472b6', c:'#fde047', g:'#16a34a', l:'#86efac' },
  },
  { // â”€â”€ Blue round daisy
    map: [
      '.....bbbbbb.....',
      '....bbbbbbbb....',
      '.....b....b.....',
      'bb...b....b...bb',
      'bb....cccc....bb',
      'bb....cccc....bb',
      'bb...b....b...bb',
      '.....b....b.....',
      '....bbbbbbbb....',
      '.....bbbbbb.....',
      '.......gg.......',
      '.......gg.......',
      '.....ll.gg......',
      '.....ll.gg......',
      '.......gg.ll....',
      '.......gg.ll....',
    ],
    colors: { b:'#60a5fa', c:'#fde047', g:'#16a34a', l:'#86efac' },
  },
  { // â”€â”€ Purple round bloom
    map: [
      '....pppppppp....',
      '..pppppppppppp..',
      '.pppp......pppp.',
      '.ppp..cccc..ppp.',
      'pppp..cccc..pppp',
      'pppp..cccc..pppp',
      '.ppp..cccc..ppp.',
      '.pppp......pppp.',
      '..pppppppppppp..',
      '....pppppppp....',
      '.......gg.......',
      '.......gg.......',
      '.....ll.gg......',
      '.....ll.gg......',
      '.......gg.ll....',
      '.......gg.ll....',
    ],
    colors: { p:'#c026d3', c:'#fde047', g:'#16a34a', l:'#86efac' },
  },
  { // â”€â”€ Yellow sunflower
    map: [
      '..yy........yy..',
      '..yy........yy..',
      '.yyyy......yyyy.',
      '.yyyy......yyyy.',
      'yy...yyyyyy...yy',
      'yy...BBBBBB...yy',
      'yy...BBBBBB...yy',
      'yy...yyyyyy...yy',
      '.yyyy......yyyy.',
      '..yy........yy..',
      '.......gg.......',
      '.......gg.......',
      '.....ll.gg......',
      '.....ll.gg......',
      '.......gg.ll....',
      '.......gg.ll....',
    ],
    colors: { y:'#fde047', B:'#78350f', g:'#16a34a', l:'#86efac' },
  },
  { // â”€â”€ Red rose
    map: [
      '...rrrrrrrrrr...',
      '..rrrr....rrrr..',
      '.rrrr..rr..rrrr.',
      'rrrr..rrrr..rrrr',
      'rrr..rRRRRr..rrr',
      'rrr..rRRRRr..rrr',
      'rrrr..rrrr..rrrr',
      '.rrrr..rr..rrrr.',
      '..rrrr....rrrr..',
      '...rrrrrrrrrr...',
      '.......gg.......',
      '.......gg.......',
      '.....ll.gg......',
      '.....ll.gg......',
      '.......gg.ll....',
      '.......gg.ll....',
    ],
    colors: { r:'#fb7185', R:'#be123c', g:'#16a34a', l:'#86efac' },
  },
  { // â”€â”€ Orange geometric cross
    map: [
      '....oooooooo....',
      '....oooooooo....',
      '....oooooooo....',
      'oooooo....oooooo',
      'ooooooOOOOoooooo',
      'ooooooOOOOoooooo',
      'oooooo....oooooo',
      '....oooooooo....',
      '....oooooooo....',
      '....oooooooo....',
      '.......gg.......',
      '.......gg.......',
      '.....ll.gg......',
      '.....ll.gg......',
      '.......gg.ll....',
      '.......gg.ll....',
    ],
    colors: { o:'#fb923c', O:'#c2410c', g:'#16a34a', l:'#86efac' },
  },
  { // â”€â”€ Cyan starburst
    map: [
      '......cccc......',
      '.....cccccc.....',
      '....cccccccc....',
      'ccc..cccccc..ccc',
      'cccc.cccccc.cccc',
      'cccc..CCCC..cccc',
      'cccc.cccccc.cccc',
      'ccc..cccccc..ccc',
      '....cccccccc....',
      '.....cccccc.....',
      '......cccc......',
      '.......gg.......',
      '.....ll.gg......',
      '.....ll.gg......',
      '.......gg.ll....',
      '.......gg.ll....',
    ],
    colors: { c:'#22d3ee', C:'#ecfeff', g:'#16a34a', l:'#86efac' },
  },
  { // â”€â”€ Lavender snowdrop
    map: [
      '......wwww......',
      '.....wwwwww.....',
      '....wwwwwwww....',
      '...wwww..wwww...',
      '..www.pppp.www..',
      '..www.pppp.www..',
      '...wwww..wwww...',
      '....wwwwwwww....',
      '.....wwwwww.....',
      '......wwww......',
      '.......gg.......',
      '.......gg.......',
      '.....ll.gg......',
      '.....ll.gg......',
      '.......gg.ll....',
      '.......gg.ll....',
    ],
    colors: { w:'#e0e7ff', p:'#818cf8', g:'#16a34a', l:'#86efac' },
  },
];

/* â”€â”€ Build SVG string â”€â”€ */
function makeSVG(def, scale) {
  const map = def.map, colors = def.colors;
  const rows = map.length, cols = map[0].length;
  const svgW = cols * PX, svgH = rows * PX;
  const dispW = Math.round(svgW * scale), dispH = Math.round(svgH * scale);
  let rects = '';
  for (let r = 0; r < rows; r++) {
    for (let c = 0; c < cols; c++) {
      const k = map[r][c];
      if (k === '.') continue;
      rects += `<rect x="${c*PX}" y="${r*PX}" width="${PX}" height="${PX}" fill="${colors[k]||'#f0f'}"/>`;
    }
  }
  return {
    svgStr: `<svg xmlns="http://www.w3.org/2000/svg" width="${dispW}" height="${dispH}" viewBox="0 0 ${svgW} ${svgH}" shape-rendering="crispEdges">${rects}</svg>`,
    w: dispW, h: dispH,
  };
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMPLIMENTS â€” personalised for Veerangna
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const COMPLIMENTS = [
  "I love you, Veerangna",
  "You are the most beautiful person I know",
  "Thinking about you is my favourite thing to do",
  "Veerangna, I fall a little more every single day",
  "You make ordinary moments feel extraordinary",
  "I am so lucky you are mine",
  "Veerangna, your laugh is my favourite sound in the world",
  "You are home to me, wherever we are",
  "I love the way your mind works, Veerangna",
  "You are the best thing that has ever happened to me",
  "Veerangna, just thinking of you makes everything better",
  "I love you more than I know how to say",
  "You are endlessly, effortlessly beautiful, Veerangna",
  "I would choose you again in every version of my life",
  "Veerangna, you make me want to be a better person",
  "Your smile does something embarrassing to my heart",
  "I love who I am when I am with you, Veerangna",
  "You are so deeply loved, more than you will ever know",
  "Veerangna, I miss you even when you are just across the room",
  "Being with you feels like the luckiest accident",
  "Veerangna, you are everything I did not know I was looking for",
  "I love the way you care so fiercely about the world",
  "You are brilliant and kind and impossibly lovely, Veerangna",
  "I want all my mornings to start with you",
  "Veerangna, you are the person I want to call when anything happens",
  "You make me laugh more than anyone ever has",
  "Veerangna, you are my favourite person on this planet",
  "I love how seriously you take the things that matter",
  "You are so warm, Veerangna, it is impossible not to love you",
  "I could look at you forever and not get tired",
  "Veerangna, from Delhi to Oxford â€” what a person you have become",
  "You carry so much with such grace, and I see all of it",
  "Veerangna, I am proud of you every single day",
  "Your laugh is still the most contagious thing I have ever heard",
  "I love the life we are building together, Veerangna",
  "You are the kind of person people write poems about",
  "Veerangna, being loved by you is the greatest privilege",
  "You see the world so clearly and so kindly",
  "Veerangna, I think about you all the time",
  "Your mind is one of the most beautiful things about you",
  "Veerangna, you make hard days survivable just by existing",
  "I love you in ways I am still discovering",
  "Veerangna, you are more than enough â€” you are everything",
  "You are the first person I want to tell good news to",
  "Veerangna, I love how much you care about the people you work for",
  "You have no idea how beautiful you look when you are passionate",
  "Veerangna, I would wait for you in every timeline",
  "Your kindness makes me better, I hope you know that",
  "Veerangna, I love every version of you",
  "You make everywhere feel like a place worth being",
  "Veerangna, your warmth is one of the great wonders of my world",
  "I love the way you fight for what is right",
  "You are so easy to love, Veerangna, it is almost unfair",
  "I love your voice, the way you think, the way you move",
  "Veerangna, you have changed me in the best ways",
  "You make me feel calm in ways I cannot explain",
  "Veerangna, I am so grateful every day that I found you",
  "You are my favourite adventure",
  "Veerangna, I love you quietly, loudly, and everything in between",
  "You are the person I want beside me for all of it",
  "Veerangna, you make the ordinary feel sacred",
  "I love how curious you are about everything",
  "You are impossibly lovely, Veerangna",
  "I love you more today than yesterday, and less than tomorrow",
  "Veerangna, you light up every room â€” especially mine",
  "You are my calm in every storm",
  "Veerangna, I love the way you see people",
  "Being near you is the easiest thing in the world",
  "Veerangna, I think you are magic, honestly",
  "You make me feel seen in ways no one else ever has",
  "Veerangna, I love your laugh, your stubbornness, all of it",
  "You are the best part of my every day",
  "Veerangna, I am yours, completely",
  "I love how deeply you feel things",
  "You are beautiful in the kind of way that matters most",
  "Veerangna, you make love feel easy",
  "I want to keep knowing you for the rest of my life",
  "Veerangna, no one has ever made me feel the way you do",
  "You are my person, always",
  "Veerangna, I love you with my whole chest",
  "You are worth every mile and every timezone",
  "Veerangna, I choose you, every day, without hesitation",
  "You are the best decision I ever made",
  "Veerangna, loving you is the easiest thing I have ever done",
  "You make my life so much richer just by being in it",
  "Veerangna, I hope you feel as loved as you make me feel",
  "You are extraordinary in the quietest, most beautiful ways",
  "Veerangna, I love you, I love you, I love you",
  "You are the reason I believe in good things",
  "Veerangna, I want every good thing for you",
  "You are my favourite thought",
  "Veerangna, I am so in love with you it is a little embarrassing",
  "You make me want to be everything you deserve",
  "Veerangna, there is truly no one like you",
  "I love you more than I know how to explain, but I'll spend forever trying",
  "Veerangna, you are my great love",
  "You are everything, Veerangna â€” absolutely everything",
  "I love you, I love you, I love you â™¥",
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   8-BIT AUDIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let audioCtx = null;
const SCALE_NOTES = [261.63,293.66,329.63,349.23,392.00,440.00,493.88,523.25,587.33,659.25];

function playBlip(idx) {
  try {
    if (!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.type = 'square';
    osc.frequency.value = SCALE_NOTES[idx % SCALE_NOTES.length];
    gain.gain.setValueAtTime(0.07, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.22);
    osc.start(audioCtx.currentTime); osc.stop(audioCtx.currentTime + 0.22);
  } catch(e) {}
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CREATE 100 FLOWERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const FLOWER_COUNT = 100;
const garden = document.getElementById('garden');
const flowers = [];
const shuffled = [...COMPLIMENTS].sort(() => Math.random() - 0.5);

for (let i = 0; i < FLOWER_COUNT; i++) {
  const def   = FLOWER_DEFS[i % FLOWER_DEFS.length];
  const scale = 0.55 + Math.random() * 1.25;   // 0.55Ã— â€“ 1.8Ã—
  const { svgStr, w, h } = makeSVG(def, scale);

  const el = document.createElement('div');
  el.className = 'flower';
  el.innerHTML = svgStr;
  garden.appendChild(el);

  const spd = 0.45 + Math.random() * 0.75;
  const ang = Math.random() * Math.PI * 2;

  const f = {
    el, w, h,
    x:  Math.random() * (window.innerWidth  - w),
    y:  Math.random() * (window.innerHeight - h),
    dx: Math.cos(ang) * spd,
    dy: Math.sin(ang) * spd,
    rotation: Math.random() * 360,
    rotSpeed: (Math.random() - 0.5) * 1.2,
    compliment: shuffled[i] || COMPLIMENTS[i % COMPLIMENTS.length],
    noteIdx: i % SCALE_NOTES.length,
    clicked: false,
  };
  el.addEventListener('click', e => handleClick(e, f));
  flowers.push(f);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATION LOOP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function animate() {
  const W = window.innerWidth, H = window.innerHeight;
  for (const f of flowers) {
    if (f.clicked) continue;  // CSS animation takes over after click
    f.x += f.dx; f.y += f.dy; f.rotation += f.rotSpeed;
    if (f.x <= 0)      { f.x = 0;       f.dx =  Math.abs(f.dx); }
    if (f.y <= 0)      { f.y = 0;       f.dy =  Math.abs(f.dy); }
    if (f.x >= W-f.w)  { f.x = W-f.w;  f.dx = -Math.abs(f.dx); }
    if (f.y >= H-f.h)  { f.y = H-f.h;  f.dy = -Math.abs(f.dy); }
    f.el.style.transform = `translate(${Math.round(f.x)}px,${Math.round(f.y)}px) rotate(${f.rotation.toFixed(1)}deg)`;
  }
  requestAnimationFrame(animate);
}
animate();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CLICK HANDLER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let score = 0;
const scoreEl     = document.getElementById('score');
const remainingEl = document.getElementById('remaining');

function handleClick(e, f) {
  if (f.clicked) return;
  e.stopPropagation();
  f.clicked = true;

  score++;
  scoreEl.textContent     = String(score).padStart(2, '0');
  remainingEl.textContent = String(FLOWER_COUNT - score).padStart(2, '0');

  playBlip(f.noteIdx);
  spawnBurst(e.clientX, e.clientY);
  showCompliment(e.clientX, e.clientY, f.compliment);

  // Freeze transform via CSS custom props, then play pop-disappear
  f.el.style.setProperty('--px', `${Math.round(f.x)}px`);
  f.el.style.setProperty('--py', `${Math.round(f.y)}px`);
  f.el.style.setProperty('--pr', `${f.rotation.toFixed(0)}deg`);
  f.el.classList.add('popping');
  setTimeout(() => f.el.remove(), 520);

  if (score === FLOWER_COUNT) setTimeout(showWinScreen, 1200);
}

/* â”€â”€ Pixel burst â”€â”€ */
const NEON = ['#ff2d9e','#00ffef','#ffdd00','#39ff14','#bf00ff','#ff6600','#ffffff'];
function spawnBurst(cx, cy) {
  for (let i = 0; i < 14; i++) {
    const p = document.createElement('div');
    p.className = 'px-particle';
    const col = NEON[i % NEON.length];
    p.style.cssText = `background:${col};box-shadow:0 0 6px ${col};left:${cx}px;top:${cy}px`;
    const ang = (i/14)*Math.PI*2 + (Math.random()-0.5)*0.5;
    const d   = 50 + Math.random()*70;
    p.style.setProperty('--tx', Math.round(Math.cos(ang)*d)+'px');
    p.style.setProperty('--ty', Math.round(Math.sin(ang)*d)+'px');
    document.body.appendChild(p);
    setTimeout(() => p.remove(), 700);
  }
}

/* â”€â”€ Compliment popup â”€â”€ */
function showCompliment(cx, cy, text) {
  const popup = document.createElement('div');
  popup.className = 'compliment-popup';
  popup.innerHTML = `
    <div class="popup-header"><span class="popup-heart">â™¥</span> COMPLIMENT <span class="popup-heart">â™¥</span></div>
    <div class="popup-body">${text}</div>`;
  let x = Math.max(8, Math.min(cx-150, window.innerWidth-316));
  let y = Math.max(8, Math.min(cy-150, window.innerHeight-160));
  popup.style.left = x+'px'; popup.style.top = y+'px';
  document.body.appendChild(popup);
  setTimeout(() => {
    popup.classList.add('fading');
    setTimeout(() => popup.remove(), 280);
  }, 3800);
}

/* â”€â”€ Win screen & jingle â”€â”€ */
function showWinScreen() {
  try {
    if (!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
    [523.25,659.25,783.99,1046.50,783.99,1046.50].forEach((freq,i) => {
      const osc=audioCtx.createOscillator(), gain=audioCtx.createGain();
      osc.connect(gain); gain.connect(audioCtx.destination);
      osc.type='square'; osc.frequency.value=freq;
      const t=audioCtx.currentTime+i*0.18;
      gain.gain.setValueAtTime(0.09,t);
      gain.gain.exponentialRampToValueAtTime(0.001,t+0.25);
      osc.start(t); osc.stop(t+0.28);
    });
  } catch(e) {}
  document.getElementById('win-screen').classList.add('show');
}

function resetGame() {
  score = 0;
  scoreEl.textContent = '00';
  remainingEl.textContent = String(FLOWER_COUNT).padStart(2,'0');
  document.getElementById('win-screen').classList.remove('show');
  // Re-create all flowers
  flowers.forEach(f => { if (f.el.parentNode) f.el.remove(); });
  flowers.length = 0;
  location.reload();
}

window.addEventListener('resize', () => {
  for (const f of flowers) {
    if (!f.clicked) {
      f.x = Math.min(f.x, window.innerWidth-f.w);
      f.y = Math.min(f.y, window.innerHeight-f.h);
    }
  }
});
</script>
</body>
</html>
